<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Location & Route Mapping</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        #map { width: 100%; height: 500px; border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); }
        input, button { margin: 10px; padding: 8px; font-size: 16px; }
    </style>
</head>
<body>

    <h1>Live Location & Route Mapping</h1>
    <p><b>Current Location:</b> <span id="current-coords">Detecting...</span></p>

    <label>Destination (Lat, Lng):</label>
    <input type="text" id="destination" placeholder="Enter lat,lng (e.g., 21.1407,79.0632)">
    <button onclick="calculateRoute()">Show Route</button>

    <div id="map"></div>

    <script>
        let map = L.map('map').setView([21.145800, 79.088155], 13);  

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        let userMarker, routingControl;
        let userLat, userLng;

        // Function to update user's current location
        function trackLocation(position) {
            userLat = position.coords.latitude;
            userLng = position.coords.longitude;
            document.getElementById("current-coords").innerText = `${userLat}, ${userLng}`;

            // If marker exists, update its position; else create it
            if (userMarker) {
                userMarker.setLatLng([userLat, userLng]).bindPopup("You are here!").openPopup();
            } else {
                userMarker = L.marker([userLat, userLng]).addTo(map).bindPopup("You are here!").openPopup();
            }

            map.setView([userLat, userLng], 15); // Center map to user location
        }

        function showError(error) {
            alert("Geolocation failed. Please enable location access.");
        }

        // Start tracking user's location
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(trackLocation, showError, { enableHighAccuracy: true });
        } else {
            alert("Geolocation is not supported by your browser.");
        }

        // Function to calculate and show route
        function calculateRoute() {
            let destInput = document.getElementById("destination").value;
            if (!destInput) {
                alert("Please enter a valid destination (lat,lng).");
                return;
            }

            let [destLat, destLng] = destInput.split(',').map(Number);

            // Remove existing route if any
            if (routingControl) {
                map.removeControl(routingControl);
            }

            // Add new route
            routingControl = L.Routing.control({
                waypoints: [
                    L.latLng(userLat, userLng),  
                    L.latLng(destLat, destLng)   
                ],
                routeWhileDragging: true
            }).addTo(map);
        }
    </script>

</body>
</html>
